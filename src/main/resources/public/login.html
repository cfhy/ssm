<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>家庭记账管理系统</title>
    <link href="css/framework-font.css" rel="stylesheet" />
    <link href="css/framework-login.css" rel="stylesheet" />
    <script src="js/jquery/jquery-2.1.1.min.js"></script>
</head>
<body>
<div class="wrapper">
    <div class="container">
        <div class="logo">
            <i class="fa fa-modx"></i>
            <h1><span>家庭记账</span>管理系统</h1>
        </div>
        <form class="form">
            <div class="row">
                <input id="txt_account" type="text" placeholder="用户名">
                <i class="fa fa-user"></i>
            </div>
            <div class="row">
                <input id="txt_password" type="password" placeholder="密码">
                <i class="fa fa-key"></i>
            </div>
            <div class="row">
                <button id="login_button" type="button"><span>登录</span></button>
            </div>
            <div class="row">
            </div>
        </form>
        <div class="login_tips"></div>
    </div>
    <ul class="bg-bubbles">
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
    </ul>
</div>
<script type="text/javascript">
    (function ($) {
        $.login = {
            formMessage: function (msg) {
                $('.login_tips').find('.tips_msg').remove();
                $('.login_tips').append('<div class="tips_msg"><i class="fa fa-question-circle"></i>' + msg + '</div>');
            },
            loginClick: function () {
                var $username = $("#txt_account");
                var $password = $("#txt_password");
                if ($username.val() == "") {
                    $username.focus();
                    $.login.formMessage('请输入用户名');
                    return false;
                }
                if ($password.val() == "") {
                    $password.focus();
                    $.login.formMessage('请输入密码。');
                    return false;
                }
                $("#login_button").attr('disabled', 'disabled').find('span').html("loading...");
                $.ajax({
                    url: "/member/login",
                    data: { username: $.trim($username.val()), password: $.trim($password.val()) },
                    type: "post",
                    dataType: "json",
                    success: function (data) {
                        if (data.code ===1) {
                            $("#login_button").find('span').html("登录成功，正在跳转...");
                            window.setTimeout(function () {
                                window.location.href = "/index";
                            }, 500);
                        } else {
                            $("#login_button").removeAttr('disabled').find('span').html("登录");
                            $.login.formMessage(data.message);
                        }
                    }
                });
            },
            init: function () {
                $('.wrapper').height($(window).height());
                $(".container").css("margin-top", ($(window).height() - $(".container").height()) / 2 - 50);
                $(window).resize(function (e) {
                    $('.wrapper').height($(window).height());
                    $(".container").css("margin-top", ($(window).height() - $(".container").height()) / 2 - 50);
                });
                $("#login_button").click(function () {
                    $.login.loginClick();
                });
            }
        };
        $(function () {
            $.login.init();
        });
    })(jQuery);
</script>
</body>
</html>
